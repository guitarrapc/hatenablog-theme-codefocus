# 個別コンポーネント仕様

ページに含まれる個別要素のスタイル仕様を示します。

## 目次スタイルの実装とデザイン仕様

目次は、記事本文中の目次とページ右上の目次ボタンで展開される目次の2つがありますが、両方とも見た目は同じものを目指します。
ただし、レイアウト領域の違いによる影響がお互いに及ぶことを避けるため、SCSSは分けて実装します(CSSのルールについて参照)。

### 目次スタイルの詳細デザイン

1. **目次のマーカー**
   * liの標準リストマーカーは消す
   * 青い丸形マーカー(直径8px)をリストアイテムの左側に配置
   * マーカーは見出しレベル(h1/h2)に関わらず同じ位置に揃える
   * 青い丸形マーカーは背景色を持ち、縦線がいい感じに青いマーカーをつないでいるように見せる

2. **縦線の接続**
   * 青い丸マーカーを縦に結ぶ薄い青色の縦線(幅3px)
   * 縦線はマーカーの中心を通るように配置します

3. **見出しレベルの表現**
   * 見出しレベルにかかわらず左インデントは揃え、フォントスタイルのみで階層を表現する
   * h1: 太字、標準サイズ、薄い色(text-low-priority)
   * h2: 通常の太さ、やや小さめサイズ(0.95em)、薄い色(text-low-priority)
   * マウスホバー時に背景色(bg-toc-hover)をつけ、X軸方向に広げて(3px)触っているように見せる

4. **インデント位置**
   * 全項目のインデント位置を揃えるため親リスト・子リストのleftを調整、マーカーも同じ位置に揃える
   * マーカーと項目テキストの距離も統一
   * ul/liの子要素でも、親と同じ位置に揃える

## タグクラウドのスタイル

タグクラウドは、カテゴリーの記事数を視覚的に表現するためのスタイルです。

### デザイン仕様

* タグクラウドのスタイルは、各カテゴリーの記事数(括弧内の数字)に応じて、フォントサイズを変えます。記事数が多いほど、フォントサイズは大きくなり、少ないほど小さくなります。
* タグクラウドは10段階のフォントサイズ(85%～170%)で表現し、記事数の平方根を元にスケーリングすることで適切な視覚的バランスを実現します。
* タグクラウドのレイアウトはflexboxを使用し、適切な間隔(gap: 0.5rem)で要素をラップして表示します。
* 各カテゴリーは丸囲みで表示します(border-radius: 18px)。
* カテゴリーの通常時の背景色は透明、ボーダーは薄い灰色(border-light変数)。
* マウスホバー時は背景色が薄い青系に変化(bg-btn-hover変数)し、テキスト装飾は表示されません。

### JavaScript実装要点

* カテゴリー要素から記事数を抽出し、表示テキストからは記事数を削除
* 記事数に応じたサイズクラス(category-size-1～10)を計算して付与
* 元のテキスト(記事数を含む)はツールチップとして保持
* 親要素に「category-cloud」クラス、各項目に「category-cloud-item」クラスを追加

## コードブロックコピー機能

コードブロックコピー機能は、記事内のコードブロック(`<pre class="code">`)に対して、コードを簡単にコピーできるボタンを提供する機能です。

### 1. コピーボタンのデザインと配置

* コードブロックをラッパー要素(`div.code-block-wrapper`)で囲み、その中に相対的にボタンを配置
* コードブロックの右上に半透明のコピーアイコンボタンを配置(SVGアイコンを使用)
* ボタンはコードブロックにマウスホバーしたときのみ表示され(opacity: 0.75)、ボタンホバー時は完全に不透明になる
* ボタンのサイズはデスクトップでは28px×28px、モバイルでは24px×24pxに調整
* ボタンの背景色は`$bg-code-light`変数、ボーダーも同じ色で統一感を出し、角丸は4pxに設定

### 2. インタラクション設計

* ユーザーがコードブロックにホバーするとコピーボタンが表示される
* ボタンにホバーするとツールチップで「Copy」と表示
* クリック時、実際のコピー実行中はボタンを一時的に非表示にして、コピー対象テキストからボタン自体を除外
* コピー成功時は「Copied」というツールチップに変化、失敗時は「Copy failed」と表示
* 状態変化は2秒後に自動的にリセット

### 3. 実装の調整

* コピー処理中にボタンが非表示になるため、自身のテキストがコピーされる問題を回避
* SVGアイコンはSCSS内で`$svg-copy-code`などの変数として定義し、`url-svg`関数で変換して使用
* ラッパー要素の導入により、既存のコードブロックスタイルを崩さず機能を追加

### 4. レスポンシブ対応

* モバイルデバイス(768px以下)ではアイコンサイズを小さく調整し、タップしやすさを維持
* ツールチップは小さい画面でも視認しやすい配置と大きさに調整

### 5. ユーザー設定方法

* ユーザーは`customize-codeblock.html`の内容をコピーしてはてなブログの「記事上HTML」に貼り付ける
* スクリプトは即時関数で実行され、外部スコープに影響を与えない設計

### 6. ファイル構成

* SCSS: `scss/lib/_code_copy.scss` - スタイル定義
* JavaScript: `js/codeblock.js` - 動作実装

この機能は複雑なライブラリに依存せず、純粋なJavaScriptと最小限のCSS/SCSSで実装されているため、ページの読み込み速度への影響を最小限に抑えています。

## ダークモード機能

ダークモード機能は、ユーザーの好みや環境に合わせてブログの表示カラーテーマを切り替える機能です。ライトモード(明るい背景・暗いテキスト)とダークモード(暗い背景・明るいテキスト)の2つのテーマを提供し、システム設定に合わせた自動切り替えもサポートしています。

### 1. 機能の特徴

* 3つの表示モード: ライトモード固定、ダークモード固定、システム設定に合わせた自動切り替え
* ページ右上に固定表示されるメインボタンとドロップダウンメニューによる直感的な操作
* ユーザーの設定をローカルストレージに保存し、次回訪問時も同じ設定を維持
* システムのダークモード設定変更をリアルタイムで検知し反映(自動モード時)
* 全ページ共通の一貫したテーマ体験を提供

### 2. UIデザインと配置

* メインボタン: 右上に固定配置された円形ボタン(直径2.5rem、モバイルでは2.2rem)
* ボタンアイコン: 現在の設定に応じて太陽(ライト)/月(ダーク)/モニター(自動)のSVGアイコンを表示
* ドロップダウンメニュー: クリックで展開する3つのオプションを持つメニュー
* 各オプション: アイコン+テキスト(「ライトモード」「ダークモード」「自動切り替え」)の組み合わせ
* 選択中のオプションは背景色で強調表示され、太字で表示

### 3. インタラクション設計

* メインボタンクリック: ドロップダウンメニューの表示/非表示を切り替え
* オプション選択: クリックするとテーマをすぐに適用し、メインボタンのアイコンを更新
* ドキュメントクリックまたはESCキー: 開いているドロップダウンを閉じる
* フェードインアニメーション: メニュー表示時の自然な視覚効果
* アクセシビリティ対応: ARIA属性によるスクリーンリーダー対応

### 4. テーマの適用方法

* CSSカスタムプロパティ(変数)を使用して全テーマカラーを一括管理
* ライトモード: `html[data-theme="light"]` または明示的な指定なし
* ダークモード: `html[data-theme="dark"]` による明示的な指定
* 自動モード: `data-theme`属性を削除し、`@media (prefers-color-scheme: dark)` によるシステム設定検出

### 5. ダークモードのカラースキーム

* 背景色: #0d1117(濃紺がかった黒)
* テキスト色: #ffffff(白)、低優先度テキスト: #8b949e(グレー)
* リンク色: #58a6ff(青)
* ボーダー色: #30363d(暗めのグレー)
* コードブロック背景: #161b22(濃紺がかった黒、メイン背景より少し明るい)
* テーブル見出し背景: #161b22
* その他の要素も全て暗めの配色に調整

### 6. 実装とファイル構成

* JavaScript: `js/dark-mode.js` - テーマ切り替えのロジックとUI構築
* SCSS: `scss/lib/_dark_mode.scss` - ダークモードのスタイル定義と切り替えボタンのデザイン
* 変数定義: `scss/lib/_variable.scss` - ライト/ダークモード用の各色変数を定義
* ユーザー設定用: `customize-dark-mode.html` - はてなブログのカスタマイズ設定に貼り付けるコード

### 7. ユーザー設定方法

* ユーザーは`customize-dark-mode.html`の内容をコピーし、はてなブログの「デザイン」→「カスタマイズ」→「記事」→「記事上HTML」に貼り付ける
* 設定後、すぐにダークモード切り替え機能が有効になり、ページ右上にボタンが表示される

この機能はCSS変数を活用することで、テーマ全体のカラースキームを簡単に切り替えられる設計になっており、ユーザーの閲覧環境や好みに合わせた快適な読書体験を提供します。
