<!-- タグクラウド機能のJavaScriptコード -->
<script>
  // タグクラウドの実装 - カテゴリー要素のフォントサイズを記事数に基づいて調整
  (function () {
    // Font size variation range
    const RANGE = 13;

    // Initialization function
    function initCategoryCloud() {
      // Get category list
      const categoryLinks = document.querySelectorAll('.hatena-module-category ul li a');
      if (!categoryLinks.length) return;

      // Extract article count data
      const counts = [];
      categoryLinks.forEach(link => {
        const match = link.textContent.match(/\((\d+)\)/);
        if (match && match[1]) {
          counts.push(parseInt(match[1], 10));
        } else {
          counts.push(0);
        }
      });

      // Calculate minimum and maximum values
      const min = Math.min(...counts);
      const max = Math.max(...counts);

      // Calculate scaling factor based on square root range
      const sqrtMin = Math.sqrt(min);
      const sqrtMax = Math.sqrt(max);
      const factor = RANGE / (sqrtMax - sqrtMin || 1); // Prevent division by zero

      // Apply styles and classes to each category link
      categoryLinks.forEach((link, i) => {
        const count = counts[i];

        // Calculate font size level (for size class)
        const levelRaw = (Math.sqrt(count) - sqrtMin) * factor;
        // Convert to 1-10 scale (enables finer granularity of size changes)
        const sizeClass = Math.max(1, Math.min(10, Math.ceil(levelRaw * 10 / RANGE)));

        // Remove article count in parentheses from text
        const text = link.textContent.trim();
        const cleanText = text.replace(/\s*\(\d+\)\s*$/, '');

        // Apply classes
        link.setAttribute('title', text); // Set original text as tooltip
        link.textContent = cleanText;

        // Add category size class (for CSS styling)
        link.classList.add(`category-size-${sizeClass}`);
        link.parentElement.classList.add('category-cloud-item');
      });

      // Add tag cloud class to parent element
      const categoryContainer = document.querySelector('.hatena-module-category ul');
      if (categoryContainer) {
        categoryContainer.classList.add('category-cloud');
      }
    }

    // Execute after page load completes
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initCategoryCloud);
    } else {
      initCategoryCloud();
    }
  })();
</script>
